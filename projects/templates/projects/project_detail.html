{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load projects_tags %}
{% load activity_tags %}
{% load bootstrap4 %}

{% block breadcrumbs %}
    {% include "projects/project_breadcrumb.html" with project=object active="active" only %}
{% endblock %}

{% block admin_tools %}
  <li class="nav-item">
    <a class="nav-link text-white" href="{% url 'projects:update' project.pk %}">{% trans 'Update' %}</a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="{% url 'projects:report_create' object.pk %}">{% trans 'New report' %}</a>
  </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="{% url 'projects:time_necessity_list' object.pk %}">{% trans 'Time necessities' %}</a> </li>
  <li class="nav-item">
    <a class="nav-link text-white" href="{% url 'projects:thing_necessity_list' object.pk %}">{% trans 'Thing necessities' %}</a>
  </li>
{% endblock %}

{% block content %}
  {% member_of user object.legal_entity_id as admin %}
  {% if admin %}
    {{ block.super }}
  {% endif %}

  <div class="row mt-4">
    <div class="col-md-8">
      <img src="holder.js/640x320"></img>
    </div>
    <div class="col-md-4 mt-4">

      {% include "projects/project_stats.html" with project=object only %}

      <a class="btn btn-primary btn-lg" href="{% url 'projects:follow_project' object.pk %}">{% trans 'Follow' %}</a>
      <a class="btn btn-primary btn-lg" href="#volunteer">{% trans 'Volunteer' %}</a>
      <a id='apply-btn' class="btn btn-primary btn-lg" href="#donate">{% trans 'Donate' %}</a>
      {% if not user.is_authenticated %}
        <script>
          $("#apply-btn").addClass('disabled')
        </script>
        <br><a href="{% url 'account_signup' %}">{% trans 'Sign up' %}</a> {% trans 'or' %} <a href="{% url 'account_login' %}">{% trans 'sign in' %}</a> {% trans 'to get involved' %}.
      {% endif %}

    </div>
  </div>
  <div class="row mt-1">
    <h3>
      {{ object.name }}
      <small>
        <a href="{{ project.legal_entity.get_absolute_url }}">{{project.legal_entity}}</a>
      </small>
    </h3>
  </div>

	<div class="row">
    <div class="body">
        <h5>{{ object.description }}</h5>
        {{ object.text | linebreaks }}
    </div>
	</div>

  <div id="volunteer">
    <h3>{% trans 'Time necessities' %}</h3>
    {% include "projects/timenecessity_list_fragment.html" with necessity_list=object.timenecessity_set.all  support_action=True only %}
  </div>

  <div id="donate">
    <h3>{% trans 'Thing necessities' %}</h3>
    {% include "projects/thingnecessity_list_fragment.html" with necessity_list=object.thingnecessity_set.all only %}
  </div>

  <h3>{% trans 'Announcements' %}</h3>
  {% if admin %}
  <form method="post" class="form" action="{% url 'projects:announcement_create' object.pk %}" >
    {% csrf_token %}
    {% bootstrap_form announcement_form layout='inline'%}
    {% buttons %}
    <button type="submit" class="btn btn-success">{% trans 'Publish' %}</button>
    {% endbuttons %}
  </form>
  {% endif %}

  {% for activity in timeline %}
    {% render_activity activity %}
  {% endfor %}

{% endblock %}
